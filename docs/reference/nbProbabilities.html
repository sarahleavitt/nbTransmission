<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Estimates relative transmission probabilities — nbProbabilities • nbTransmission</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Estimates relative transmission probabilities — nbProbabilities" />
<meta property="og:description" content="The function nbProbabilities uses naive Bayes and an interative estimation
procedure to estimate relative transmission probabilities" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nbTransmission</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/nbTransmission-vignette.html">Introductory tutorial for R Package nbTransmission</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/sv1205/nbTransmission/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Estimates relative transmission probabilities</h1>
    <small class="dont-index">Source: <a href='https://github.com/sv1205/nbTransmission/blob/master/R/calcProbabilities.R'><code>R/calcProbabilities.R</code></a></small>
    <div class="hidden name"><code>nbProbabilities.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The function <code>nbProbabilities</code> uses naive Bayes and an interative estimation
procedure to estimate relative transmission probabilities</p>
    </div>

    <pre class="usage"><span class='fu'>nbProbabilities</span><span class='op'>(</span>
  <span class='va'>orderedPair</span>,
  <span class='va'>indIDVar</span>,
  <span class='va'>pairIDVar</span>,
  <span class='va'>goldStdVar</span>,
  <span class='va'>covariates</span>,
  label <span class='op'>=</span> <span class='st'>""</span>,
  l <span class='op'>=</span> <span class='fl'>1</span>,
  n <span class='op'>=</span> <span class='fl'>10</span>,
  m <span class='op'>=</span> <span class='fl'>1</span>,
  nReps <span class='op'>=</span> <span class='fl'>10</span>,
  progressBar <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>orderedPair</th>
      <td><p>The name of the ordered pair-level dataset with the covariates.</p></td>
    </tr>
    <tr>
      <th>indIDVar</th>
      <td><p>The name (in quotes) of the column with the individual ID. 
(data frame <code>orderedPair</code> must have columns called <code>&lt;indIDVar&gt;.1</code> and <code>&lt;indIDVar&gt;.2</code>).</p></td>
    </tr>
    <tr>
      <th>pairIDVar</th>
      <td><p>The name (in quotes) of the column with the unique pair ID variable.</p></td>
    </tr>
    <tr>
      <th>goldStdVar</th>
      <td><p>The name (in quotes) of the column with a logical vector defining
training links/non-links</p></td>
    </tr>
    <tr>
      <th>covariates</th>
      <td><p>A character vector containing the covariate column names (in quotes).
All covariates need to be categorical factor variables.</p></td>
    </tr>
    <tr>
      <th>label</th>
      <td><p>An optional label string for the run.</p></td>
    </tr>
    <tr>
      <th>l</th>
      <td><p>Laplace smoothing parameter that is added to each cell.</p></td>
    </tr>
    <tr>
      <th>n</th>
      <td><p>The number of folds for nxm cross validation (should be at least 10).</p></td>
    </tr>
    <tr>
      <th>m</th>
      <td><p>The number of times to create n folds in nxm cross validation.</p></td>
    </tr>
    <tr>
      <th>nReps</th>
      <td><p>The number of times to randomly select the "true" infector (should be at least 10).</p></td>
    </tr>
    <tr>
      <th>progressBar</th>
      <td><p>A logical indicating if a progress bar should be printed (default is TRUE).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>List containing two data frames:</p><ol>
<li><p><code>probabilities</code> - a data frame of transmission probabilities. Column names:</p><ul>
<li><p><code>label</code> - the optional label of the run.</p></li>
<li><p><code>&lt;pairIDVar&gt;</code> - the pair ID with the name specified.</p></li>
<li><p><code>pAvg</code> - the mean transmission probability for the pair over all iterations.</p></li>
<li><p><code>pSD</code> - the standard deviation of the transmission probability for the pair
        over all iterations.</p></li>
<li><p><code>pScaled</code> - the mean relative transmission probability for the pair over.
        all iterations: pAvg scaled so that the probabilities for all infectors per infectee add to 1.</p></li>
<li><p><code>pRank</code> - the rank of the probability of the the pair out of all pairs for that
       infectee (in case of ties all values have the minimum rank of the group).</p></li>
<li><p><code>nEstimates</code> - the number of probability estimates that contributed to pAvg. This
       represents the number of prediction datasets this pair was included in over the <code>nxm</code>
       cross prediction repeated <code>nReps</code> times.</p></li>
</ul></li>
<li><p><code>estimates</code> - a data frame with the contribution of covariates. Column names:</p><ul>
<li><p><code>label</code> - the optional label of the run</p></li>
<li><p><code>level</code> - the covariate name and level</p></li>
<li><p><code>nIter</code> - the number of iterations included in the estimates: <code>n*m*nReps</code></p></li>
<li><p><code>logorMean</code> - the mean value of the log odds ratio across iterations</p></li>
<li><p><code>logorSE</code> - the standard error of the log odds ratio across iterations</p></li>
<li><p><code>logorCILB</code> - the lower bound of the 95<!-- % confidence interval of the log odds ratio -->
        across iterations</p></li>
<li><p><code>logorCIUB</code> - the upper bound of the 95<!-- % confidence interval of the log odds ratio -->
        across iterations</p></li>
</ul></li>
</ol>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This algorithm takes a dataset of ordered possible infector-infectee pairs in an
infectious disease outbreak or cluster and estimates the relative probability the cases are
linked by direct transmission using a classification technique called naive Bayes (NB).
NB is a simple machine learning algorithm that uses Bayes rule to estimate the
probability of an outcome in a prediction dataset given a set of covariates from
the observed frequencies in a training dataset.</p>
<p>The input dataset - <code>orderedPair</code> - should represent ordered pairs of cases
(where the potential infector was observed before the infectee) and have
a unique identifier for each pair (<code>pairIDVar</code>) as well as the individual ids that are
included in the pair (<code>&lt;indIDVar&gt;.1</code> and <code>&lt;indIDVar&gt;.2</code>). If cases are concurrent
(meaning the order cannot determined) both orders can be included.</p>
<p>A subset of pairs should also have pathogen WGS, contact investigation,  or some other
'gold standard' defined by <code>goldStdVar</code> which should be a logical vector with
<code>TRUE</code> indicating links, <code>FALSE</code> nonlinks, and <code>NA</code> if
the pair cannot be used to train (does not have the information or is indeterminate).
These pairs will be used to a training dataset of probable links and non/links.
The covariates can be any categorical variables and could represent
spatial, clinical, demographic, and temporal characteristics of the case pair.</p>
<p>Because the outcomes in the training set represent probable and not certain 
transmission events and a given case could have mulitple probable infectors, 
the algorithm uses an iterative estimation procedure. This procedure randomly chooses one
link of all of the possible links to include in the training dataset <code>nReps</code>
times, and then uses <code>mxn</code> cross prediction to give all pairs a turn 
in the prediction dataset.</p>
<p>The output of this function is a list of two dataframes: one with the estimates of the
transmission probabilities (<code>probabilities</code>) and the other with the contribution of
the covariates to the probabilities in the form of odds ratios (<code>estimates</code>). The 
95<!-- % confidence intervals reported for these odds ratios use Rubin's Rules, a technique developed -->
for multiple imputation, to pool the error across all iterations.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Barnard J. and Rubin D. Small-Sample Degrees of Freedom with Multiple Imputation
<em>Biometrika</em>. 1999 Dec;86(4):948-55.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## Use the pairData dataset which represents a TB-like outbreak</span>
<span class='co'># First create a dataset of ordered pairs</span>
<span class='va'>orderedPair</span> <span class='op'>&lt;-</span> <span class='va'>pairData</span><span class='op'>[</span><span class='va'>pairData</span><span class='op'>$</span><span class='va'>infectionDiffY</span> <span class='op'>&gt;=</span> <span class='fl'>0</span>, <span class='op'>]</span>

<span class='co'>## Create a variable called snpClose that will define probable links</span>
<span class='co'># (&lt;3 SNPs) and nonlinks (&gt;12 SNPs) all pairs with between 2-12 SNPs</span>
<span class='co'># will not be used to train.</span>
<span class='va'>orderedPair</span><span class='op'>$</span><span class='va'>snpClose</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>orderedPair</span><span class='op'>$</span><span class='va'>snpDist</span> <span class='op'>&lt;</span> <span class='fl'>3</span>, <span class='cn'>TRUE</span>,
                        <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>orderedPair</span><span class='op'>$</span><span class='va'>snpDist</span> <span class='op'>&gt;</span> <span class='fl'>12</span>, <span class='cn'>FALSE</span>, <span class='cn'>NA</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>orderedPair</span><span class='op'>$</span><span class='va'>snpClose</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 
#&gt; FALSE  TRUE 
#&gt;   881   248 </div><div class='input'>
<span class='co'>## Running the algorithm</span>
<span class='co'>#NOTE should run with nReps &gt; 1.</span>
<span class='va'>resGen</span> <span class='op'>&lt;-</span> <span class='fu'>nbProbabilities</span><span class='op'>(</span>orderedPair <span class='op'>=</span> <span class='va'>orderedPair</span>,
                            indIDVar <span class='op'>=</span> <span class='st'>"individualID"</span>,
                            pairIDVar <span class='op'>=</span> <span class='st'>"pairID"</span>,
                            goldStdVar <span class='op'>=</span> <span class='st'>"snpClose"</span>,
                            covariates <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Z1"</span>, <span class='st'>"Z2"</span>, <span class='st'>"Z3"</span>, <span class='st'>"Z4"</span>, <span class='st'>"timeCat"</span><span class='op'>)</span>,
                            label <span class='op'>=</span> <span class='st'>"SNPs"</span>, l <span class='op'>=</span> <span class='fl'>1</span>,
                            n <span class='op'>=</span> <span class='fl'>10</span>, m <span class='op'>=</span> <span class='fl'>1</span>, nReps <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
</div><div class='output co'>#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%</div><div class='input'>                            
<span class='co'>## Merging the probabilities back with the pair-level data</span>
<span class='va'>nbResults</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/merge.html'>merge</a></span><span class='op'>(</span><span class='va'>resGen</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>, <span class='va'>orderedPair</span>, by <span class='op'>=</span> <span class='st'>"pairID"</span>, all <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Sarah V Leavitt.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


