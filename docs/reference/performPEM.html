<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Executes the PEM algorthim to estimate the generation/serial interval distribution — performPEM • nbTransmission</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Executes the PEM algorthim to estimate the generation/serial interval distribution — performPEM"><meta property="og:description" content="The function performPEM uses relative transmission probabilities to estimate
the generation/serial interval distribution"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nbTransmission</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/nbTransmission-vignette.html">Introductory tutorial for R Package nbTransmission</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/sarahleavitt/nbTransmission/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Executes the PEM algorthim to estimate the generation/serial interval distribution</h1>
    <small class="dont-index">Source: <a href="https://github.com/sarahleavitt/nbTransmission/blob/HEAD/R/calcSI.R" class="external-link"><code>R/calcSI.R</code></a></small>
    <div class="hidden name"><code>performPEM.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The function <code>performPEM</code> uses relative transmission probabilities to estimate
the generation/serial interval distribution</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">performPEM</span><span class="op">(</span></span>
<span>  <span class="va">df</span>,</span>
<span>  <span class="va">indIDVar</span>,</span>
<span>  <span class="va">timeDiffVar</span>,</span>
<span>  <span class="va">pVar</span>,</span>
<span>  <span class="va">initialPars</span>,</span>
<span>  shift <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  epsilon <span class="op">=</span> <span class="fl">1e-05</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>df</dt>
<dd><p>The name of the dateset with transmission probabilities.</p></dd>


<dt>indIDVar</dt>
<dd><p>The name (in quotes) of the individual ID columns
(data frame <code>df</code> must have variables called <code>&lt;indIDVar&gt;.1</code>
 and <code>&lt;indIDVar&gt;.2</code>).</p></dd>


<dt>timeDiffVar</dt>
<dd><p>The name (in quotes) of the column with the difference
in time between infection (generation interval) or symptom onset (serial interval) for the
pair of cases. The units of this variable (hours, days, years) defines the units of the 
resulting distribution.</p></dd>


<dt>pVar</dt>
<dd><p>The column name (in quotes) of the transmission probabilities.</p></dd>


<dt>initialPars</dt>
<dd><p>A vector of length two with the shape and scale 
to initialize the gamma distribution parameters.</p></dd>


<dt>shift</dt>
<dd><p>A value in the same units as <code>timeDiffVar</code> that the
gamma distribution should be shifted. The Default value of 0 is an 
unmodifed gamma distribution.</p></dd>


<dt>epsilon</dt>
<dd><p>The difference between successive estimates of the shape and
scale parameters that indicates convergence.</p></dd>


<dt>plot</dt>
<dd><p>A logical indicating if a plot should be printed showing the
parameter estimates at each iteration.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A data frame with one row and the following columns:</p><ul><li><p><code>nIndividuals</code> - the number of infectees who have intervals included
   in the SI estimate.</p></li>
<li><p><code>shape</code> - the shape of the estimated gamma distribution for the interval.</p></li>
<li><p><code>scale</code> - the scale of the estimated gamma distribution for the interval.</p></li>
<li><p><code>meanSI</code> - the mean of the estimated gamma distribution for the interval 
   (<code>shape * scale + shift</code>).</p></li>
<li><p><code>medianSI</code> - the median of the estimated gamma distribution for the interval
   (<code>qgamma(0.5, shape, scale) + shift)</code>).</p></li>
<li><p><code>sdSI</code> - the standard deviation of the estimated gamma distribution for
   the interval (<code>shape * scale ^ 2</code>)</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p>This function is meant to be called by <code><a href="estimateSI.html">estimateSI</a></code>
which estimates the generation/serial interval distribution as well as clustering the
probabilities, but can be called directly. The main reason to call <code>performPEM</code>
directly is for the <code>plot</code> argument. Setting this argument to <code>TRUE</code>
will produce a plot of the shape and scale parameters at each iteration.
For more details on the PEM algorithm see <code><a href="estimateSI.html">estimateSI</a></code>.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Hens N, Calatayud L, Kurkela S, Tamme T, Wallinga J. Robust reconstruction and
analysis of outbreak data: influenza A (H1N1) v transmission in a school-based 
population. <em>American Journal of Epidemiology</em>. 2012 Jul 12;176(3):196-203.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="nbProbabilities.html">nbProbabilities</a></code> <code><a href="clusterInfectors.html">clusterInfectors</a></code>
 <code>performPEM</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## First, run the algorithm without including time as a covariate.</span></span></span>
<span class="r-in"><span><span class="va">orderedPair</span> <span class="op">&lt;-</span> <span class="va">pairData</span><span class="op">[</span><span class="va">pairData</span><span class="op">$</span><span class="va">infectionDiffY</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create a variable called snpClose that will define probable links</span></span></span>
<span class="r-in"><span><span class="co"># (&lt;3 SNPs) and nonlinks (&gt;12 SNPs) all pairs with between 2-12 SNPs</span></span></span>
<span class="r-in"><span><span class="co"># will not be used to train.</span></span></span>
<span class="r-in"><span><span class="va">orderedPair</span><span class="op">$</span><span class="va">snpClose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">orderedPair</span><span class="op">$</span><span class="va">snpDist</span> <span class="op">&lt;</span> <span class="fl">3</span>, <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                        <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">orderedPair</span><span class="op">$</span><span class="va">snpDist</span> <span class="op">&gt;</span> <span class="fl">12</span>, <span class="cn">FALSE</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">orderedPair</span><span class="op">$</span><span class="va">snpClose</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FALSE  TRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   881   246 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Running the algorithm</span></span></span>
<span class="r-in"><span><span class="co">#NOTE should run with nReps &gt; 1.</span></span></span>
<span class="r-in"><span><span class="va">resGen</span> <span class="op">&lt;-</span> <span class="fu"><a href="nbProbabilities.html">nbProbabilities</a></span><span class="op">(</span>orderedPair <span class="op">=</span> <span class="va">orderedPair</span>,</span></span>
<span class="r-in"><span>                            indIDVar <span class="op">=</span> <span class="st">"individualID"</span>,</span></span>
<span class="r-in"><span>                            pairIDVar <span class="op">=</span> <span class="st">"pairID"</span>,</span></span>
<span class="r-in"><span>                            goldStdVar <span class="op">=</span> <span class="st">"snpClose"</span>,</span></span>
<span class="r-in"><span>                            covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Z1"</span>, <span class="st">"Z2"</span>, <span class="st">"Z3"</span>, <span class="st">"Z4"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            label <span class="op">=</span> <span class="st">"SNPs"</span>, l <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                            n <span class="op">=</span> <span class="fl">10</span>, m <span class="op">=</span> <span class="fl">1</span>, nReps <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%</span>
<span class="r-in"><span>                            </span></span>
<span class="r-in"><span><span class="co">## Merging the probabilities back with the pair-level data</span></span></span>
<span class="r-in"><span><span class="va">nbResultsNoT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">resGen</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">orderedPair</span>, by <span class="op">=</span> <span class="st">"pairID"</span>, all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Estimating the serial interval</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Using all pairs and plotting the parameters</span></span></span>
<span class="r-in"><span>  <span class="fu">performPEM</span><span class="op">(</span><span class="va">nbResultsNoT</span>, indIDVar <span class="op">=</span> <span class="st">"individualID"</span>, timeDiffVar <span class="op">=</span> <span class="st">"infectionDiffY"</span>,</span></span>
<span class="r-in"><span>  pVar <span class="op">=</span> <span class="st">"pScaled"</span>, initialPars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, shift <span class="op">=</span> <span class="fl">0</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="performPEM-1.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       shape     scale</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31 1.216135 0.7913686</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Clustering the probabilities first</span></span></span>
<span class="r-in"><span><span class="va">allClust</span> <span class="op">&lt;-</span> <span class="fu"><a href="clusterInfectors.html">clusterInfectors</a></span><span class="op">(</span><span class="va">nbResultsNoT</span>, indIDVar <span class="op">=</span> <span class="st">"individualID"</span>, pVar <span class="op">=</span> <span class="st">"pScaled"</span>,</span></span>
<span class="r-in"><span>                            clustMethod <span class="op">=</span> <span class="st">"hc_absolute"</span>, cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">performPEM</span><span class="op">(</span><span class="va">allClust</span><span class="op">[</span><span class="va">allClust</span><span class="op">$</span><span class="va">cluster</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span>, indIDVar <span class="op">=</span> <span class="st">"individualID"</span>,</span></span>
<span class="r-in"><span>           timeDiffVar <span class="op">=</span> <span class="st">"infectionDiffY"</span>, pVar <span class="op">=</span> <span class="st">"pScaled"</span>,</span></span>
<span class="r-in"><span>           initialPars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, shift <span class="op">=</span> <span class="fl">0</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="performPEM-2.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      shape    scale</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 1.032647 1.934014</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># The above is equivalent to the following code using the function estimateSI()</span></span></span>
<span class="r-in"><span><span class="co"># though the plot will not be printed and more details will be added</span></span></span>
<span class="r-in"><span><span class="fu"><a href="estimateSI.html">estimateSI</a></span><span class="op">(</span><span class="va">nbResultsNoT</span>, indIDVar <span class="op">=</span> <span class="st">"individualID"</span>, timeDiffVar <span class="op">=</span> <span class="st">"infectionDiffY"</span>,</span></span>
<span class="r-in"><span>           pVar <span class="op">=</span> <span class="st">"pScaled"</span>, clustMethod <span class="op">=</span> <span class="st">"hc_absolute"</span>, cutoff <span class="op">=</span> <span class="fl">0.05</span>,</span></span>
<span class="r-in"><span>           initialPars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   clustMethod cutoff nIndividuals nInfectors  pCluster    shape    scale</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 hc_absolute   0.05           77          1 0.7777778 1.032647 1.934014</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     meanSI medianSI    sdSI</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 1.997153 1.401749 1.96533</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Sarah V Leavitt.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

